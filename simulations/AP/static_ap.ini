[General]
network = abcd.simulations.StaticAP
sim-time-limit = 20s
warmup-period = 1.5s

**.vector-recording = true
**.scalar-recording = true
**.bin-recording = true


# Mobility parameters
**.mobility.constraintAreaMinZ = 0m
**.mobility.constraintAreaMaxZ = 0m
**.mobility.initFromDisplayString = true

# Visualizer configuration
*.visualizer.*.mediumVisualizer.displaySignals = true
*.visualizer.*.mediumVisualizer.displayTransmissions = true
*.visualizer.*.mediumVisualizer.displayReceptions = true

*.visualizer.*.networkRouteVisualizer.displayRoutes = true
*.visualizer.*.networkRouteVisualizer.packetFilter = "*VoIP*"
*.visualizer.*.networkRouteVisualizer.lineColor = "blue"

*.visualizer.*.mobilityVisualizer.displayVelocities = true
*.visualizer.*.mobilityVisualizer.displayMovementTrails = true

*.visualizer.*.interfaceTableVisualizer.displayInterfaceTables = true
*.visualizer.*.ieee80211Visualizer.displayAssociations = true
*.visualizer.mediumVisualizer.displaySignals = true
# Enable IEEE 802.11 visualization
*.radioMedium.backgroundNoise.power = -100dBm

# Access Point Radio Configuration
*.accessPoint.wlan[0].radio.transmitter.power = 4mW        # Transmission power
*.ccessPoint.wlan[0].radio.transmitter.communicationRange = 200m  # Maximum range
*.accessPoint.wlan[0].radio.receiver.sensitivity = -95dBm   # Receiver sensitivity



num-rngs = 2
**.internet.ipv4Delayer.rng-0 = 1

**.internetCloud.ipv4Delayer.config = xmldoc("./internet.xml")

 



[Config VoIP_AP_QoS]
result-dir = results/VoIP_AP_QoS


**.numUe = ${numUEs=1}

# Client mobility
*.ue[*].mobility.initFromDisplayString = true
*.ue[*].mobility.initialX = uniform(500m,500m)
*.ue[*].mobility.initialY = uniform(500m,500m)
*.ue[*].mobility.initialZ = 0m
*.ue[*].mobility.speed = 0mps
*.ue[*].mobility.typename = "StationaryMobility"

# Applications
*.ue[*].numApps = 1+ ${directions=2}
*.server.numApps = ${directions} * ${numUEs}

# Background UDP traffic (client to server)
*.ue[*].app[2].typename = "UdpBasicApp"
*.ue[*].app[2].destPort = 5000
*.ue[*].app[2].messageLength = 1024B
*.ue[*].app[2].sendInterval = 0.01s  # High frequency
*.ue[*].app[2].startTime = uniform(0s, 0.1s)
# Background UDP sink on server
*.server.app[2].typename = "UdpSink"
*.server.app[2].localPort = 5000

#---------- UL -----------
*.server.app[0..0].typename = "VoIPReceiverWithHandover"
*.server.app[0..0].localPort = 4000+ancestorIndex(0)
*.server.app[0..0].enableSessionContinuity = true
*.server.app[0..0].jitterBufferSize = 150ms
*.server.app[0..0].enableAdaptiveJitterBuffer = true

*.ue[*].app[1].typename = "VoIPSenderWithHandover"
*.ue[*].app[1].PacketSize = 40
*.ue[*].app[1].destAddress = "server"
*.ue[*].app[1].destPort = 4000+ancestorIndex(1)
*.ue[*].app[1].localPort = 4088
*.ue[*].app[1].startTime = uniform(0s,0.02s)
*.ue[*].app[1].sendInterval = 0.01ms
*.ue[*].app[1].enableSessionContinuity = true
*.ue[*].app[1].enableInterfaceMonitoring = true
*.ue[*].app[1].preferredInterface = "auto"
#-------------------------

#---------- DL -----------
*.ue[*].app[0].typename = "VoIPReceiverWithHandover"
*.ue[*].app[0].localPort = 3000
*.ue[*].app[0].enableSessionContinuity = true
*.ue[*].app[0].jitterBufferSize = 150ms
*.ue[*].app[0].enableAdaptiveJitterBuffer = true

*.server.app[1..].typename = "VoIPSenderWithHandover"
*.server.app[1..].PacketSize = 40
*.server.app[1..].destAddress = "ue["+string(ancestorIndex(0)-1)+"]"
*.server.app[1..].destPort = 3000
*.server.app[1..].localPort = 3088+ancestorIndex(0)
*.server.app[1..].sendInterval = 0.01ms
*.server.app[1..].startTime = uniform(0s,0.02s)
*.server.app[1..].enableSessionContinuity = true
*.server.app[1..].enableInterfaceMonitoring = true
*.server.app[1..].preferredInterface = "auto"
#-------------------------

# DiffServ Configuration
*.wifiRouter.ipv4.config.filters = xml("<filters>" + 
    "<filter name='VoIP' proto='udp' destPort='3000,4000'/>" +
    "</filters>")

# Configure DiffServ queuing
*.wifiRouter.queue.typename = "DiffservQueue"
*.wifiRouter.queue.packetCapacity = 100
*.wifiRouter.queue.bufferSize = 1000

# Define traffic classes
*.wifiRouter.queue.numQueues = 4
*.wifiRouter.queue.classifier.typename = "DiffservClassifier"

# Queue weights for Weighted Round Robin
*.wifiRouter.queue.scheduler.typename = "WrrScheduler"
*.wifiRouter.queue.scheduler.weights = "4 3 2 1"

# Set DSCP marks for different traffic
*.app[*].dscpMark = 46  # EF (Expedited Forwarding) for VoIP

# Queue parameters per traffic class
*.wifiRouter.queue.queue[0].typename = "DropTailQueue"  # EF queue
*.wifiRouter.queue.queue[0].packetCapacity = 100


# WiFi QoS Configuration
*.accessPoint.wlan[0].mac.typename = "Ieee80211Mac"
*.accessPoint.wlan[0].mac.qosStation = true
*.accessPoint.wlan[0].mac.ctrl.typename = "Ieee80211MacCtrl"
*.accessPoint.wlan[0].mac.dcf.channelAccess.typename = "EdcaChannelAccess"

# Same for UE
*.ue[*].wlan[0].mac.typename = "Ieee80211Mac"
*.ue[*].wlan[0].mac.qosStation = true
*.ue[*].wlan[0].mac.ctrl.typename = "Ieee80211MacCtrl"
*.ue[*].wlan[0].mac.dcf.channelAccess.typename = "EdcaChannelAccess"

# default queues
**.eth[*].queue.typename = "EthernetQosQueue"
**.queue.dataQueue.typename = "DropTailQueue"
**.queue.packetCapacity = 100
**.queue.dataQueue.packetCapacity = 100


[Config VoIP_AP_NoQoS]
result-dir = results/VoIP_AP_NoQoS
# Detailed VoIP statistics recording

**.numclient = ${numclients=1}

# Client mobility
*.client[*].mobility.initFromDisplayString = true
*.client[*].mobility.initialX = uniform(500m,500m)
*.client[*].mobility.initialY = uniform(500m,500m)
*.client[*].mobility.initialZ = 0m
*.client[*].mobility.speed = 0mps
*.client[*].mobility.typename = "StationaryMobility"

# Applications
**.numUe = ${numUEs=1}
*.ue[*].numApps = 1+ ${directions=2}
*.server.numApps = ${directions} * ${numUEs}

# Background UDP traffic (client to server)
*.ue[*].app[2].typename = "UdpBasicApp"
*.ue[*].app[2].destAddresses = "server"
*.ue[*].app[2].destPort = 5000
*.ue[*].app[2].messageLength = 1024B
*.ue[*].app[2].sendInterval = 0.01s  # High frequency
*.ue[*].app[2].startTime = uniform(0s, 0.1s)
# Background UDP sink on server
*.server.app[2].typename = "UdpSink"
*.server.app[2].localPort = 5000

#---------- UL -----------
*.server.app[0..0].typename = "VoIPReceiverWithHandover"
*.server.app[0..0].localPort = 4000+ancestorIndex(0)
*.server.app[0..0].enableSessionContinuity = true
*.server.app[0..0].jitterBufferSize = 150ms
*.server.app[0..0].enableAdaptiveJitterBuffer = true

*.ue[*].app[1].typename = "VoIPSenderWithHandover"
*.ue[*].app[1].PacketSize = 40
*.ue[*].app[1].destAddress = "server"
*.ue[*].app[1].destPort = 4000+ancestorIndex(1)
*.ue[*].app[1].localPort = 4088
*.ue[*].app[1].startTime = uniform(0s,0.02s)
*.ue[*].app[1].sendInterval = 0.01ms
*.ue[*].app[1].enableSessionContinuity = true
*.ue[*].app[1].enableInterfaceMonitoring = true
*.ue[*].app[1].preferredInterface = "auto"
#-------------------------

#---------- DL -----------
*.ue[*].app[0].typename = "VoIPReceiverWithHandover"
*.ue[*].app[0].localPort = 3000
*.ue[*].app[0].enableSessionContinuity = true
*.ue[*].app[0].jitterBufferSize = 150ms
*.ue[*].app[0].enableAdaptiveJitterBuffer = true

*.server.app[1..].typename = "VoIPSenderWithHandover"
*.server.app[1..].PacketSize = 40
*.server.app[1..].destAddress = "ue["+string(ancestorIndex(0)-1)+"]"
*.server.app[1..].destPort = 3000
*.server.app[1..].localPort = 3088+ancestorIndex(0)
*.server.app[1..].sendInterval = 0.01ms
*.server.app[1..].startTime = uniform(0s,0.02s)
*.server.app[1..].enableSessionContinuity = true
*.server.app[1..].enableInterfaceMonitoring = true
*.server.app[1..].preferredInterface = "auto"
#-------------------------

# Add delay and packet loss to router interfaces
*.wifiRouter.queue.typename = "DropTailQueue"
*.wifiRouter.queue.packetCapacity = 100  # Smaller buffer
*.wifiRouter.queue.frameCapacity = 100

# Add random packet dropping
*.wifiRouter.queue.packetDropperFunction = "uniform(0, 1) < 0.02"  # 2% drop rate

# QoS Performance Measurement
*.wifiRouter.queue.*.packetDropped.scalar-recording = true
*.mac.*.queueingTime.scalar-recording = true
*.mac.*.txPk.scalar-recording = true
*.mac.*.rxPkOk.scalar-recording = true
